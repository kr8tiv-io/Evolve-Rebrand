document.addEventListener("DOMContentLoaded",e=>{gsap.registerPlugin(ScrollTrigger);const t=window.matchMedia("(max-width: 768px)").matches,o=window.matchMedia("(hover: hover)").matches&&window.matchMedia("(pointer: fine)").matches,n=e=>!!e.closest(".home-hero, .comm-hero, .ind-hero, .res-hero"),r=document.querySelector(".site-header");let a=0;window.addEventListener("scroll",()=>{const e=window.pageYOffset;e>50&&e>a?r.classList.add("is-hidden"):r.classList.remove("is-hidden"),a=e});if(document.querySelectorAll(".reveal-text, .hero-title-unified").forEach(e=>{t&&!n(e)||gsap.fromTo(e,{y:50,opacity:0,rotateX:10},{y:0,opacity:1,rotateX:0,duration:1.2,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 85%",toggleActions:"play none none reverse"}})}),gsap.utils.toArray(".parallax-img").forEach(e=>{gsap.to(e,{yPercent:20,ease:"none",scrollTrigger:{trigger:e,start:"top bottom",end:"bottom top",scrub:!0}})}),o){document.querySelectorAll(".eng-card-unified, .kr8-img-card, .kr8-panel-card, .eh-card").forEach(e=>{e.addEventListener("mousemove",t=>{const o=e.getBoundingClientRect(),n=t.clientX-o.left,r=t.clientY-o.top;e.style.setProperty("--mouse-x",`${n}px`),e.style.setProperty("--mouse-y",`${r}px`)})})}if(o){document.querySelectorAll(".btn-magnetic:not(.header-cta)").forEach(e=>{e.addEventListener("mousemove",t=>{const o=e.getBoundingClientRect(),n=t.clientX-o.left-o.width/2,r=t.clientY-o.top-o.height/2;gsap.to(e,{x:.3*n,y:.3*r,duration:.3,ease:"power2.out"})}),e.addEventListener("mouseleave",()=>{gsap.to(e,{x:0,y:0,duration:.5,ease:"elastic.out(1, 0.3)"})})})}document.querySelectorAll("video.video-half-speed").forEach(e=>{const t=()=>{e.playbackRate=.5};e.readyState>=1?t():e.addEventListener("loadedmetadata",t,{once:!0})});if(!window.matchMedia("(prefers-reduced-motion: reduce)").matches&&o){const e=document.createElement("div");e.className="cursor-effect",document.body.appendChild(e);let t=window.innerWidth/2,o=window.innerHeight/2,n=t,r=o,a=e.offsetWidth||220,i=!1;const d=(e,t,o)=>(1-o)*e+o*t,c=()=>{n=d(n,t,.12),r=d(r,o,.12),e.style.transform=`translate3d(${n-a/2}px, ${r-a/2}px, 0)`,requestAnimationFrame(c)},l=n=>{t=n.clientX,o=n.clientY,i||(e.classList.add("is-active"),i=!0)},s=()=>{e.classList.remove("is-active"),i=!1};window.addEventListener("mousemove",l,{passive:!0}),window.addEventListener("mouseout",s),window.addEventListener("blur",s),window.addEventListener("resize",()=>{a=e.offsetWidth||a}),c()}const i=document.querySelector(".mobile-toggle"),d=document.querySelector(".nav-links"),c=document.querySelector(".nav-close-btn");i&&d&&i.addEventListener("click",()=>{d.classList.toggle("active")}),c&&d&&c.addEventListener("click",()=>{d.classList.remove("active")});const l=()=>{(()=>{if("undefined"==typeof gsap||"undefined"==typeof ScrollTrigger)return;if(gsap.registerPlugin(ScrollTrigger),gsap.utils.toArray(".kr8-anim-item").forEach(e=>{t&&!n(e)||gsap.fromTo(e,{y:60,opacity:0},{y:0,opacity:1,duration:1.2,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 85%",toggleActions:"play reverse play reverse"}})}),t)return;gsap.utils.toArray(".kr8-anim-grid").forEach(e=>{const t=e.children;gsap.fromTo(t,{y:30,opacity:0},{y:0,opacity:1,duration:.8,stagger:.15,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 90%",toggleActions:"play reverse play reverse"}})}),gsap.utils.toArray(".kr8-anim").forEach(e=>{gsap.fromTo(e,{y:60,opacity:0},{y:0,opacity:1,duration:1.2,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 85%",toggleActions:"play reverse play reverse"}})}),gsap.utils.toArray(".kr8-ba-anim").forEach(e=>{gsap.fromTo(e,{y:60,opacity:0},{y:0,opacity:1,duration:1,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 85%",toggleActions:"play none none none"}})});const e=document.querySelectorAll(".kr8-menu-stagger .kr8-service-item");e.length&&gsap.fromTo(e,{x:-30,opacity:0},{x:0,opacity:1,duration:.8,stagger:.1,ease:"power3.out",scrollTrigger:{trigger:".kr8-menu-stagger",start:"top 80%",toggleActions:"play reverse play reverse"}})})(),(()=>{if("undefined"==typeof gsap||"undefined"==typeof ScrollTrigger)return;const e=document.querySelector(".evolve-horizon-wrap"),t=document.querySelector(".eh-track");if(!e||!t)return;const o=()=>t.scrollWidth-e.offsetWidth,n=()=>{window.innerWidth<769||(ScrollTrigger.getById("eh-scroll")?.kill(),gsap.set(t,{x:0}),gsap.to(t,{id:"eh-scroll",x:()=>-o(),ease:"none",scrollTrigger:{trigger:".eh-pin-spacer",pin:!0,scrub:1,start:"center center",end:()=>"+="+(o()+500),invalidateOnRefresh:!0}}))};"function"==typeof ScrollTrigger.matchMedia?ScrollTrigger.matchMedia().add("(min-width: 769px)",()=>(("ontouchstart"in window||navigator.maxTouchPoints>0)&&"function"==typeof ScrollTrigger.normalizeScroll&&(window.__ehScrollNormalized||(ScrollTrigger.normalizeScroll(!0),window.__ehScrollNormalized=!0)),n(),ScrollTrigger.addEventListener("refreshInit",n),()=>{ScrollTrigger.getById("eh-scroll")?.kill(),ScrollTrigger.removeEventListener("refreshInit",n)})):window.innerWidth>=769&&(n(),ScrollTrigger.addEventListener("refreshInit",n))})()};(()=>{const e=document.querySelectorAll(".kr8-service-item"),t=document.querySelectorAll(".kr8-content-panel"),o=document.querySelector(".kr8-summary-box p");o&&o.classList.add("kr8-backlight-hover");const n=o=>{e.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),o.classList.add("active");const n=o.getAttribute("data-target"),r=document.getElementById(n);r&&r.classList.add("active")};e.forEach(e=>{e.addEventListener("click",()=>n(e)),e.addEventListener("mouseenter",()=>n(e))})})(),document.querySelectorAll(".kr8-split-frame.kr8-interactive").forEach(e=>{let t=!1;const o=e.querySelector(".kr8-split-layer.one"),n=e.querySelector(".kr8-split-handle"),r=r=>{if(!t)return;const a=e.getBoundingClientRect();let i=(r.clientX||r.touches&&r.touches[0].clientX)-a.left;i=Math.max(0,Math.min(i,a.width));const d=i/a.width*100;o.style.width=`${d}%`,n.style.left=`${d}%`},a=e=>{t=!0,r(e)},i=()=>{t=!1};e.addEventListener("mousedown",a),e.addEventListener("touchstart",a),window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("mousemove",r),window.addEventListener("touchmove",r),o.style.width="50%",n.style.left="50%"}),"complete"===document.readyState?l():window.addEventListener("load",l),window.addEventListener("load",()=>{document.querySelectorAll('video[data-preload="defer"]').forEach(e=>{e.preload="auto",e.load()}),setTimeout(()=>{window.dispatchEvent(new Event("resize")),window.dispatchEvent(new Event("scroll")),"undefined"!=typeof ScrollTrigger&&ScrollTrigger.refresh()},1e3)})});const wizardState={currentStep:1,totalSteps:3,projectType:null,timeline:null,serviceType:null,files:[]};let modal,modalContainer,closeBtn,steps,stepIndicators,nextBtn,backBtn,submitBtn,isNavigating=!1;function openModal(){isNavigating||(modal||(modal=document.getElementById("booking-modal")),"function"==typeof window.loadGoogleMaps&&window.loadGoogleMaps(),modal?(modal.classList.add("active"),document.body.style.overflow="hidden"):console.error("Booking modal not found!"))}window.addEventListener("beforeunload",()=>{isNavigating=!0}),window.openBookingModal=openModal,document.addEventListener("DOMContentLoaded",function(){if(modal=document.getElementById("booking-modal"),modalContainer=document.querySelector(".modal-container"),closeBtn=document.querySelector(".modal-close"),steps=document.querySelectorAll(".wizard-step"),stepIndicators=document.querySelectorAll(".step-indicator"),nextBtn=document.getElementById("wizard-next"),backBtn=document.getElementById("wizard-back"),submitBtn=document.getElementById("wizard-submit"),!modal)return void console.error("Booking modal element not found in DOM");function e(){modal.classList.remove("active"),document.body.style.overflow="",wizardState.currentStep=1,wizardState.projectType=null,wizardState.timeline=null,wizardState.serviceType=null,wizardState.files=[],t(),document.querySelectorAll(".option-card").forEach(e=>e.classList.remove("selected")),document.getElementById("booking-form").reset(),document.getElementById("preview-container").innerHTML=""}function t(){steps.forEach(e=>e.classList.remove("active")),steps[wizardState.currentStep-1].classList.add("active"),stepIndicators.forEach((e,t)=>{t<wizardState.currentStep?e.classList.add("active"):e.classList.remove("active")}),backBtn.style.display=1===wizardState.currentStep?"none":"flex",wizardState.currentStep===wizardState.totalSteps?(nextBtn.style.display="none",submitBtn.style.display="flex"):(nextBtn.style.display="flex",submitBtn.style.display="none"),o()}function o(){let e=!1;switch(wizardState.currentStep){case 1:e=wizardState.projectType&&wizardState.timeline;break;case 2:e=document.getElementById("location-input").value.length>0&&wizardState.serviceType;break;case 3:const t=document.getElementById("contact-name").value,o=document.getElementById("contact-phone").value,n=document.getElementById("contact-email").value;e=t.length>0&&o.length>0&&n.length>0}nextBtn.disabled=!e,submitBtn.disabled=!e}modal.classList.remove("active"),document.body.style.overflow="",window.selectOption=function(e,t){"project"===e?(wizardState.projectType=t,document.querySelectorAll('[data-type="project"]').forEach(e=>{e.classList.remove("selected")}),document.querySelector(`[data-type="project"][data-value="${t}"]`).classList.add("selected")):"timeline"===e?(wizardState.timeline=t,document.querySelectorAll('[data-type="timeline"]').forEach(e=>{e.classList.remove("selected")}),document.querySelector(`[data-type="timeline"][data-value="${t}"]`).classList.add("selected")):"service"===e&&(wizardState.serviceType=t,document.querySelectorAll('[data-type="service"]').forEach(e=>{e.classList.remove("selected")}),document.querySelector(`[data-type="service"][data-value="${t}"]`).classList.add("selected")),o()};const n=document.getElementById("drop-zone"),r=document.getElementById("file-input"),a=document.getElementById("preview-container");function i(e){e.preventDefault(),e.stopPropagation()}function d(e){[...e.target.files].slice(0,5-wizardState.files.length).forEach(e=>{wizardState.files.push(e),function(e){const t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){const e=document.createElement("img");e.src=t.result,e.classList.add("preview-thumb"),a.appendChild(e)}}(e)})}n.addEventListener("click",()=>r.click()),["dragenter","dragover","dragleave","drop"].forEach(e=>{n.addEventListener(e,i,!1)}),["dragenter","dragover"].forEach(e=>{n.addEventListener(e,()=>n.classList.add("dragover"),!1)}),["dragleave","drop"].forEach(e=>{n.addEventListener(e,()=>n.classList.remove("dragover"),!1)}),n.addEventListener("drop",function(e){const t=e.dataTransfer;d({target:{files:t.files}})},!1),r.addEventListener("change",d,!1),closeBtn&&closeBtn.addEventListener("click",e),modal&&modal.addEventListener("click",t=>{t.target===modal&&e()}),nextBtn&&nextBtn.addEventListener("click",function(){wizardState.currentStep<wizardState.totalSteps&&(wizardState.currentStep++,t())}),backBtn&&backBtn.addEventListener("click",function(){wizardState.currentStep>1&&(wizardState.currentStep--,t())});const c=document.getElementById("booking-form");c&&c.addEventListener("submit",function(t){t.preventDefault(),wizardState.projectType,wizardState.timeline,wizardState.serviceType,document.getElementById("location-input").value,document.getElementById("project-details").value,document.getElementById("special-circumstances").value,document.getElementById("contact-name").value,document.getElementById("contact-phone").value,document.getElementById("contact-email").value,wizardState.files,alert("Thank you! Your request has been submitted. We'll contact you within 2 hours."),e()});const l=document.getElementById("location-input"),s=document.getElementById("contact-name"),u=document.getElementById("contact-phone"),m=document.getElementById("contact-email");l&&l.addEventListener("input",o),s&&s.addEventListener("input",o),u&&u.addEventListener("input",o),m&&m.addEventListener("input",o)}),window.initAutocomplete=function(){if("undefined"==typeof google||void 0===google.maps)return void console.warn("Google Maps API not loaded - autocomplete disabled");const e=document.getElementById("location-input");if(!e)return void console.warn("Location input not found");const t={fields:["formatted_address","geometry","name"],strictBounds:!1};try{const o=new google.maps.places.Autocomplete(e,t);o.addListener("place_changed",()=>{const t=o.getPlace();t.geometry&&t.geometry.location&&(e.style.borderColor="#39FF14",validateStep())})}catch(e){console.warn("Google Places Autocomplete failed:",e)}};